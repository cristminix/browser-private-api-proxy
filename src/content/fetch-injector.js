(()=>{var i=null,c=o=>{if(i&&i.connected)try{i.emit("message",o)}catch(u){console.error("[CRXJS] Error sending data to socket.io server:",u)}else console.warn("[CRXJS] Socket.io not ready, queueing message:",o)},p=()=>{try{typeof window.io<"u"?(i=window.io("http://localhost:4001"),i.on("connect",()=>{console.log("[CRXJS] Connected to socket.io server at http://localhost:4001")}),i.on("connect_error",o=>{console.error("[CRXJS] Socket.io connection error:",o)}),i.on("disconnect",o=>{console.log("[CRXJS] Socket.io connection disconnected:",o),setTimeout(p,3e3)}),i.on("message",o=>{console.log("[CRXJS] Received message from socket.io server:",o)})):console.error("[CRXJS] Socket.io client not found in window. Make sure to load socket.io client script first.")}catch(o){console.error("[CRXJS] Failed to connect to socket.io server:",o),setTimeout(p,3e3)}};p();if(!window.fetchInterceptorInjected){console.log("[CRXJS] Fetch interceptor injected into page DOM");let o=window.fetch;window.fetch=async function(...l){let[e,n]=l;console.log("[CRXJS] Intercepted fetch request:",{url:typeof e=="string"?e:e.url||e,method:n?.method||"GET",headers:n?.headers,body:n?.body});try{let s={type:"fetch_request",timestamp:Date.now(),url:typeof e=="string"?e:e.url||e,method:n?.method||"GET",headers:n?.headers,body:n?.body};c(s);let a=e,r={...n};r.headers?r.headers={...r.headers,"X-Private-API-Proxy":"browser-extension"}:r.headers={"X-Private-API-Proxy":"browser-extension"};let t=await o.call(this,a,r),f=t.clone();try{let d=await f.text();console.log("[CRXJS] Fetch response:",{url:typeof e=="string"?e:e.url||e,status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries()),body:d});let h={type:"fetch_response",timestamp:Date.now(),url:typeof e=="string"?e:e.url||e,status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries()),body:d};c(h)}catch{console.log("[CRXJS] Fetch response (stream):",{url:typeof e=="string"?e:e.url||e,status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries())});let h={type:"fetch_response",timestamp:Date.now(),url:typeof e=="string"?e:e.url||e,status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries())};c(h)}return t}catch(s){console.error("[CRXJS] Fetch error:",s);let a={type:"fetch_error",timestamp:Date.now(),url:typeof e=="string"?e:e.url||e,error:s instanceof Error?s.message:String(s)};throw c(a),s}};let u=window.XMLHttpRequest,y=u.prototype.open,m=u.prototype.send;window.XMLHttpRequest.prototype.open=function(l,e,n=!0,s,a){return this._requestInfo={method:l,url:e,async:n,user:s,password:a},y.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(l){let e=this._requestInfo;console.log("[CRXJS] Intercepted XMLHttpRequest:",{method:e?.method,url:e?.url,body:l});let n={type:"xhr_request",timestamp:Date.now(),method:e?.method,url:e?.url,body:l};c(n);let s=this.onload,a=this.onerror;return this.onload=function(r){console.log("[CRXJS] XMLHttpRequest response:",{status:this.status,statusText:this.statusText,response:this.response});let t={type:"xhr_response",timestamp:Date.now(),method:e?.method,url:e?.url,status:this.status,statusText:this.statusText,response:this.response};c(t),s&&s.call(this,r)},this.onerror=function(r){console.error("[CRXJS] XMLHttpRequest error:",{method:e?.method,url:e?.url});let t={type:"xhr_error",timestamp:Date.now(),method:e?.method,url:e?.url,error:"XMLHttpRequest error"};c(t),a&&a.call(this,r)},m.apply(this,arguments)},window.fetchInterceptorInjected=!0,console.log("[CRXJS] Fetch and XMLHttpRequest interception enabled via DOM injection")}})();
